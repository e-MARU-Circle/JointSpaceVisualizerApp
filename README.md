JointSpaceVisualizer ver.2
==========================

PyQt5 + PyVista 製の 3D 距離可視化ツールです。ターゲットモデルとソースモデルの表面距離を `vtkDistancePolyDataFilter` で計算し、カラーリングや比較ビューで確認できます。アプリケーションはコマンドラインから起動して利用します（スタンドアロンパッケージは提供していません）。

⚠️ 重要：利用制限（アプリ内と同じ内容）
--------------------------------------

- 本ソフトウェアは医療機器ではありません。診断・治療・予防などの医学的判断に使用しないでください。
- 利用可能範囲は研究用途に限ります。臨床現場での意思決定には使用できません。
- 利用により発生したいかなる損害についても、開発側は責任を負いません。

セットアップ
-------------

1. Python 3.9 以降を用意（macOS / Windows / Linux）
2. 仮想環境を作成し依存関係をインストール
   ```bash
   python -m venv venv
   source venv/bin/activate        # Windows は venv\Scripts\activate
   python -m pip install --upgrade pip
   python -m pip install -r requirements.txt
   ```

CLI からの起動
---------------

```bash
python app/main.py
```

- 初回起動時は「重要事項」タブで同意チェックが必要です。
- macOS でウインドウが真っ白になる場合は `export QT_MAC_WANTS_LAYER=1` を試してください。
- オフスクリーンで動かす場合は `QT_QPA_PLATFORM=offscreen` を指定します。

主な機能
---------

- STL / PLY / VTK / VTP のロード（上顎骨モデル・下顎骨モデル）
- VTK による距離計算とカスタム LUT（0–5 mm のレンジを赤→青で表示）
- 表示／不透明度スライダー、デシメーション設定（処理時間短縮用）
- 距離結果の保存（VTP/PLY/STL）・カラー焼き込み PLY の出力
- スナップショットタブ、左右比較ビュー（カメラリンク ON/OFF）
- ビュー毎の明るさスライダー、Zoom/Reset ボタン、マウス／ホイール操作
- デバッグタブでアプリケーションログを参照可能

テスト / スモークテスト
-------------------------

- 最小動作確認：
  ```bash
  python scripts/smoke_test.py
  ```
- 単体テスト：
  ```bash
  python -m pip install -r requirements-dev.txt
  python -m pytest
  ```

備考
----

- スタンドアロンのインストーラーや DMG などのパッケージは提供していません。各プラットフォームで Python 環境を用意し、上記の手順を実行してください。
- 必要に応じて仮想環境を分けることで、他プロジェクトとの依存関係の衝突を避けられます。

既知の注意点
--------------

- 中止ボタンは VTK の処理キャンセルを要求し、応答がない場合は数秒で安全に UI を復帰させます。完了メッセージが出るまで待ってから操作を再開してください。
- 大容量メッシュでは距離計算に時間がかかります。必要に応じてデシメーション率を下げ、処理時間と精度のバランスを調整してください。

ライセンス
-----------

TBD
